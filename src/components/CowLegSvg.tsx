import { type SVGProps } from "react";

import styles from "./cow-anatomy.module.css";

export type LegSectionId =
  | "leg-left-17"
  | "leg-left-16"
  | "leg-left-15"
  | "leg-left-14"
  | "leg-right-17"
  | "leg-right-16"
  | "leg-right-15"
  | "leg-right-14";

export const LEG_SECTION_IDS: LegSectionId[] = [
  "leg-left-17",
  "leg-left-16",
  "leg-left-15",
  "leg-left-14",
  "leg-right-17",
  "leg-right-16",
  "leg-right-15",
  "leg-right-14",
];

export type LegSectionClick = {
  sectionId: LegSectionId;
  sectionNumber: number;
};

export type CowLegSvgProps = Omit<SVGProps<SVGSVGElement>, "onClick"> & {
  onSectionClick?: (section: LegSectionClick) => void;
  activeSectionIds?: ReadonlyArray<LegSectionId>;
  sectionClassNames?: Partial<Record<LegSectionId, string>>;
  showHitboxes?: boolean;
};

type SectionDef = {
  id: LegSectionId;
  number: number;
  d: string;
  hitboxD?: string;
  cx: number;
  cy: number;
};

const LEFT_OUTLINE_PATHS = [
  "M356.28 425.477C355.018 439.368 341.549 457.324 337.34 464.69C337.866 465.742 344.284 469.359 353.124 474.411C361.963 479.462 376.801 485.736 379.958 485.21C379.958 483.632 373.959 473.148 375.222 468.097C376.8 461.783 381.536 461.783 387.849 458.626C392.9 456.1 394.163 454.416 394.163 453.89C391.532 439.158 386.271 404.641 386.271 384.437V324.454C386.271 314.352 405.02 231.77 405.02 215.6L387.849 127.05L310.507 182.141C309.98 205.818 326.606 319.403 327.869 337.082C329.131 354.761 342.075 376.018 348.388 384.437C351.545 392.329 357.543 411.587 356.28 425.477Z",
  "M215.79 199.755L144.76 117.674C186.326 117.674 395.157 71.8981 389.418 135.037C388.155 148.928 377.842 191.337 372.055 199.755C363.637 197.651 340.802 193.441 316.81 193.441C292.817 193.441 226.839 197.651 215.79 199.755Z",
  "M296.305 408.115C290.442 410.461 272.628 408.115 267.893 408.115V348.132C267.893 339.293 266.314 311.827 264.736 300.778C264.736 298.673 273.376 292.023 296.305 289.729C312.089 288.15 323.138 288.15 321.559 294.464C321.559 300.778 323.138 315.3 323.138 322.877C323.138 332.348 323.138 341.819 321.559 354.447C319.981 367.075 297.883 407.484 296.305 408.115Z",
  "M259.993 449.156C257.468 455.469 235.265 475.464 226.846 483.882C226.846 485.987 235.054 489.88 248.944 494.932C262.834 499.983 266.833 496.51 271.042 498.089L286.827 482.304L299.454 485.461L305.768 480.725L296.297 463.362V430.214V409.693H267.885C265.781 420.217 262.519 442.842 259.993 449.156Z",
  "M211.066 507.565L226.851 485.466C228.429 487.044 233.796 491.148 242.635 494.937C251.474 498.725 265.259 498.62 271.047 498.094C271.047 501.251 270.1 508.512 266.312 512.3C261.576 517.036 253.684 520.193 242.635 521.771C233.796 523.034 221.063 520.193 215.802 518.614V512.3L211.066 507.565Z",
  "M337.336 466.517L308.924 490.194C314.712 492.825 330.391 498.087 346.807 498.087C363.222 498.087 374.692 489.668 378.375 485.459C375.745 484.933 368.589 483.249 361.013 480.723C353.436 478.198 342.071 470.2 337.336 466.517Z",
  "M296.299 291.308C281.146 293.834 268.939 298.674 264.73 300.779C261.047 288.677 260.774 261.8 245.789 240.797C229.46 217.91 219.45 206.36 215.799 199.756C226.848 197.652 291.879 193.442 312.083 193.442C332.287 193.442 361.541 197.652 373.642 199.756C369.433 206.07 359.436 221.855 353.123 234.483C346.809 247.111 328.394 277.628 321.554 291.308C318.397 290.256 311.452 288.782 296.299 291.308Z",
];

const RIGHT_OUTLINE_PATHS = [
  "M567.631 474.198C558.12 471.027 553.1 466.712 551.779 464.95C557.063 456.144 568.952 436.152 574.236 426.64C580.842 414.75 588.768 408.146 594.052 396.257C599.336 384.368 599.336 371.157 598.015 350.02C596.958 333.11 588.768 241.695 584.805 198.102L671.992 326.241L652.177 350.02C645.572 357.946 628.398 392.293 613.867 426.64C599.336 460.987 603.299 470.234 588.768 464.95C582.427 461.78 583.484 473.317 584.805 479.482C583.043 479.042 577.143 477.368 567.631 474.198Z",
  "M574.237 217.908C568.953 206.283 567.632 187.965 567.632 180.919C573.796 164.626 595.109 128.342 631.041 113.546C666.973 98.7506 714.706 102.978 734.081 106.941C734.961 115.308 733.816 139.967 722.191 171.672C707.66 211.303 705.018 227.155 705.018 253.576C705.018 279.997 715.586 294.528 726.154 311.702C736.723 328.875 736.723 320.949 740.686 327.554C744.649 334.159 743.328 334.159 740.686 343.406C738.044 352.654 740.686 379.074 736.723 405.495C732.76 431.916 749.933 451.731 749.933 462.3C749.933 472.868 748.612 474.189 743.328 480.794C739.1 486.078 739.805 490.922 740.686 492.683H722.191C710.302 492.683 705.018 483.436 705.018 483.436C705.018 483.436 711.623 453.052 710.302 431.916C709.245 415.006 706.339 393.165 705.018 384.358C700.174 379.515 687.845 366.921 677.277 355.296C664.066 340.764 661.424 335.48 642.93 311.702C624.436 287.923 617.83 276.034 603.299 257.539C588.768 239.045 580.842 232.439 574.237 217.908Z",
  "M690.49 501.937L705.021 483.443C706.342 484.764 709.512 488.199 716.91 491.369C724.308 494.54 735.845 494.451 740.688 494.011C740.688 496.653 741.217 502.73 738.046 505.9C734.083 509.864 726.157 512.506 716.91 513.827C709.512 514.884 698.856 512.506 694.453 511.185V505.9L690.49 501.937Z",
  "M550.459 464.946L526.68 484.761C531.524 486.963 544.646 491.367 558.385 491.367C572.123 491.367 581.723 484.321 584.805 480.798C582.604 480.358 576.615 478.949 570.274 476.835C563.933 474.721 554.422 468.028 550.459 464.946Z",
];

const SECTIONS: SectionDef[] = [
  {
    id: "leg-left-17",
    number: 17,
    d: "M 148.750 119.250 L 271.250 105.000 L 313.250 103.000 L 339.500 104.000 L 363.000 108.000 L 377.500 114.250 L 386.000 123.250 L 388.000 135.500 L 381.000 169.500 L 371.500 197.500 L 329.250 192.000 L 295.250 192.000 L 216.250 198.000 Z",
    cx: 277.97,
    cy: 154.77,
  },
  {
    id: "leg-left-16",
    number: 16,
    d: "M 218.750 201.250 L 263.000 197.000 L 320.750 195.000 L 360.000 199.000 L 370.750 201.750 L 320.750 289.250 L 298.500 289.250 L 266.250 298.250 L 259.000 265.250 L 252.750 249.000 Z",
    hitboxD:
      "M 200.000 195.000 L 380.000 195.000 L 380.000 305.000 L 200.000 305.000 Z",
    cx: 297.99,
    cy: 244.09,
  },
  {
    id: "leg-left-15",
    number: 15,
    d: "M 266.500 302.250 L 278.250 297.000 L 294.500 293.000 L 307.250 291.500 L 320.000 293.000 L 321.750 322.250 L 320.000 355.500 L 311.000 378.500 L 295.000 407.000 L 269.500 406.250 L 269.500 348.000 Z",
    hitboxD:
      "M 245.000 290.000 L 345.000 290.000 L 345.000 415.000 L 245.000 415.000 Z",
    cx: 293.37,
    cy: 345.73,
  },
  {
    id: "leg-left-14",
    number: 14,
    d: "M 229.250 483.750 L 260.750 451.250 L 269.250 411.250 L 294.500 411.250 L 294.750 463.500 L 303.250 480.750 L 299.000 483.750 L 286.250 480.750 L 271.000 496.000 L 253.500 495.000 L 235.250 488.000 Z",
    hitboxD:
      "M 205.000 405.000 L 325.000 405.000 L 325.000 525.000 L 205.000 525.000 Z",
    cx: 277.97,
    cy: 447.37,
  },
  {
    id: "leg-right-17",
    number: 17,
    d: "M 569.000 180.500 L 579.000 161.250 L 595.250 140.250 L 611.000 126.250 L 630.500 115.000 L 653.250 108.000 L 674.250 105.000 L 711.250 105.000 L 733.000 108.500 L 732.000 128.500 L 728.000 149.250 L 711.750 198.000 L 665.000 197.000 L 634.500 199.000 L 602.500 205.000 L 574.000 213.750 L 570.000 197.500 Z",
    cx: 657.896,
    cy: 162.924,
  },
  {
    id: "leg-right-16",
    number: 16,
    d: "M 575.250 216.250 L 605.000 207.000 L 639.500 201.000 L 673.250 199.500 L 710.750 200.750 L 705.250 225.750 L 703.750 256.000 L 706.000 274.250 L 711.250 289.000 L 679.750 292.000 L 636.250 301.000 L 608.000 261.250 L 583.000 230.750 Z",
    hitboxD:
      "M 560.000 195.000 L 730.000 195.000 L 730.000 305.000 L 560.000 305.000 Z",
    cx: 659.436,
    cy: 250.704,
  },
  {
    id: "leg-right-15",
    number: 15,
    d: "M 639.000 303.500 L 677.000 295.000 L 713.000 292.000 L 728.250 317.500 L 738.750 326.750 L 742.000 333.000 L 738.250 350.250 L 735.500 402.000 L 719.000 406.750 L 709.250 405.500 L 706.000 383.250 L 671.250 346.750 Z",
    hitboxD:
      "M 620.000 290.000 L 760.000 290.000 L 760.000 415.000 L 620.000 415.000 Z",
    cx: 710.256,
    cy: 352.343,
  },
  {
    id: "leg-right-14",
    number: 14,
    d: "M 706.750 481.000 L 711.750 443.500 L 709.500 409.250 L 721.750 409.000 L 735.000 405.000 L 736.250 427.000 L 748.750 461.500 L 747.750 472.000 L 740.000 483.500 L 738.500 491.250 L 719.250 491.000 L 709.250 485.750 Z",
    hitboxD:
      "M 685.000 400.000 L 770.000 400.000 L 770.000 500.000 L 685.000 500.000 Z",
    cx: 728.736,
    cy: 452.444,
  },
];

function cx(...classNames: Array<string | undefined | false>): string {
  return classNames.filter(Boolean).join(" ");
}

export function CowLegSvg({
  className,
  onSectionClick,
  activeSectionIds = [],
  sectionClassNames,
  showHitboxes = false,
  ...svgProps
}: CowLegSvgProps) {
  const handleSectionClick = (
    sectionId: LegSectionId,
    sectionNumber: number,
  ) => {
    onSectionClick?.({ sectionId, sectionNumber });
  };

  return (
    <svg
      {...svgProps}
      className={cx(
        styles.root,
        showHitboxes && styles.showHitboxes,
        className,
      )}
      viewBox="0 0 970 524"
      role="img"
      aria-label="Interactive cow leg anatomy"
    >
      <rect
        className={styles.labelBadge}
        x="822.36"
        y="98.56"
        width="90.238"
        height="43.664"
        rx="3.08"
      />
      <text className={styles.labelText} x="867.479" y="120.392">
        A
      </text>

      {SECTIONS.map((section) => {
        const isActive = activeSectionIds.includes(section.id);

        return (
          <g
            key={section.id}
            id={`section-${section.id}`}
            data-section-id={section.id}
            data-section-number={section.number}
            className={cx(
              styles.section,
              isActive && styles.sectionActive,
              sectionClassNames?.[section.id],
            )}
            onClick={() => handleSectionClick(section.id, section.number)}
          >
            <path className={styles.hitbox} d={section.hitboxD ?? section.d} />
            <path className={styles.visual} d={section.d} />
            <circle
              className={styles.indicator}
              cx={section.cx}
              cy={section.cy}
              r="13.09"
            />
            <text
              className={cx(styles.indicatorText, styles.indicatorTextSmall)}
              x={section.cx}
              y={section.cy + 1}
            >
              {section.number}
            </text>
          </g>
        );
      })}

      {LEFT_OUTLINE_PATHS.map((d, index) => (
        <path
          key={d}
          className={styles.outline}
          d={d}
          strokeDasharray={index === 0 ? "451px 221px" : ""}
        />
      ))}

      {RIGHT_OUTLINE_PATHS.map((d, index) => (
        <path
          key={d}
          className={styles.outline}
          d={d}
          strokeDasharray={index === 0 ? "255px 216px" : ""}
        />
      ))}
    </svg>
  );
}

export default CowLegSvg;
